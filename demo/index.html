<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staga Library Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .demo-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .demo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .demo-card h2 {
            color: #4c51bf;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .demo-card h2::before {
            content: attr(data-emoji);
            font-size: 1.5em;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: #4c51bf;
            color: white;
        }

        .btn-primary:hover {
            background: #3730a3;
            transform: scale(1.05);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-group input,
        .input-group select {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #4c51bf;
        }

        .output {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
        }

        .state-display {
            background: #1f2937;
            color: #f3f4f6;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .reactive-value {
            display: inline-block;
            background: #dbeafe;
            color: #1e40af;
            padding: 5px 10px;
            border-radius: 20px;
            margin: 2px;
            font-weight: 600;
            font-size: 12px;
        }

        .event-item {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 4px;
            font-size: 12px;
        }

        .success {
            background: #dcfce7;
            border-left-color: #22c55e;
        }

        .error {
            background: #fecaca;
            border-left-color: #ef4444;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .metric {
            text-align: center;
            background: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #4c51bf;
        }

        .metric-label {
            font-size: 0.8em;
            color: #64748b;
            margin-top: 5px;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .recording {
            animation: pulse 1s infinite;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Staga Library Demo</h1>
            <p>Explore state management, reactive selectors, transactions, and event replay</p>
        </div>

        <div class="demo-grid">
            <!-- State Management Demo -->
            <div class="demo-card">
                <h2 data-emoji="üè™">State Management</h2>
                <div class="input-group">
                    <input type="text" id="user-name" placeholder="User Name" value="John Doe">
                    <input type="number" id="user-balance" placeholder="Balance" value="1000">
                </div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="updateUser()">Update User</button>
                    <button class="btn btn-warning" onclick="undo()">Undo</button>
                    <button class="btn btn-warning" onclick="redo()">Redo</button>
                    <button class="btn btn-success" onclick="createSnapshot()">Snapshot</button>
                </div>
                <div class="output" id="state-output"></div>
            </div>

            <!-- Reactive Selectors Demo -->
            <div class="demo-card">
                <h2 data-emoji="‚ö°">Reactive Selectors</h2>
                <div>
                    <strong>Live Values:</strong><br>
                    <span class="reactive-value">User Balance: <span id="balance-display">$1000</span></span>
                    <span class="reactive-value">Order Count: <span id="order-count">0</span></span>
                    <span class="reactive-value">Can Afford Laptop: <span id="can-afford">Yes</span></span>
                </div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="addRandomOrder()">Add Order</button>
                    <button class="btn btn-danger" onclick="removeLastOrder()">Remove Order</button>
                </div>
                <div class="output" id="reactive-output"></div>
            </div>

            <!-- Transaction Demo -->
            <div class="demo-card">
                <h2 data-emoji="üîÑ">Transactions</h2>
                <div class="input-group">
                    <select id="product-select">
                        <option value="laptop">Laptop ($999)</option>
                        <option value="mouse">Mouse ($29)</option>
                        <option value="keyboard">Keyboard ($79)</option>
                    </select>
                    <input type="number" id="quantity" placeholder="Quantity" value="1" min="1">
                </div>
                <div class="controls">
                    <button class="btn btn-success" onclick="processOrder()">Process Order</button>
                    <button class="btn btn-primary" onclick="processOrderWithFallback()">Order with Fallback</button>
                    <button class="btn btn-danger" onclick="processFailingOrder()">Test Failure</button>
                </div>
                <div class="output" id="transaction-output"></div>
            </div>

            <!-- Event Replay Demo -->
            <div class="demo-card">
                <h2 data-emoji="üìπ">Event Replay</h2>
                <div class="controls">
                    <button class="btn btn-primary" onclick="startRecording()" id="record-btn">Start Recording</button>
                    <button class="btn btn-warning" onclick="stopRecording()" id="stop-btn" disabled>Stop
                        Recording</button>
                    <button class="btn btn-success" onclick="replayEvents()" id="replay-btn" disabled>Replay
                        Events</button>
                    <button class="btn btn-danger" onclick="clearEvents()">Clear Events</button>
                </div>
                <div class="controls">
                    <button class="btn btn-warning" onclick="testEventGeneration()" id="test-events-btn">Test Event
                        Generation</button>
                </div>
                <div id="recording-status"></div>
                <div class="output" id="replay-output"></div>
            </div>
        </div>

        <!-- Full State Display -->
        <div class="demo-card">
            <h2 data-emoji="üîç">Complete State & Metrics</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h3>Current State</h3>
                    <div class="state-display" id="full-state"></div>
                </div>
                <div>
                    <h3>Performance Metrics</h3>
                    <div class="metrics" id="metrics-display"></div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>üöÄ Built with Staga - A TypeScript library for state management with transactions, reactive selectors,
                and event replay</p>
        </div>
    </div>

    <!-- Load Staga Library -->
    <script src="../dist/index.global.js"></script>

    <script>
        // Initialize Staga application
        let saga;
        let isRecording = false;
        let recordedEvents = [];

        // Reactive selectors
        let userBalance$, orderCount$, canAffordLaptop$, orderStats$, state$;

        // Product catalog
        const products = {
            laptop: { name: 'Laptop', price: 999 },
            mouse: { name: 'Mouse', price: 29 },
            keyboard: { name: 'Keyboard', price: 79 }
        };

        function initializeApp() {
            // Initial state
            const initialState = {
                user: {
                    id: 'user1',
                    name: 'John Doe',
                    balance: 1000,
                    isVip: false
                },
                orders: [],
                products: [
                    { id: 'laptop', name: 'Laptop', price: 999, stock: 10 },
                    { id: 'mouse', name: 'Mouse', price: 29, stock: 50 },
                    { id: 'keyboard', name: 'Keyboard', price: 79, stock: 25 }
                ],
                notifications: [],
                analytics: {
                    totalOrders: 0,
                    totalRevenue: 0,
                    averageOrderValue: 0
                }
            };

            // Create Saga Manager with options
            saga = Staga.SagaManager.createWithOptions(initialState, {
                maxUndoHistory: 20,
                autoCleanup: true,
                snapshotInterval: 5
            });

            // Set up reactive selectors
            setupReactiveSelectors();

            // Set up rendering to automatically update UI on state changes
            setupRendering();

            // Set up event listeners
            setupEventListeners();

            log('‚úÖ Staga demo initialized successfully!');
        }

        function setupReactiveSelectors() {
            // Create reactive selectors
            userBalance$ = saga.selectProperty('user').select(user => user.balance);
            orderCount$ = saga.selectProperty('orders').select(orders => orders.length);

            // Computed values
            canAffordLaptop$ = saga.computed(
                userBalance$,
                saga.selectProperty('products').select(products =>
                    products.find(p => p.name === 'Laptop')?.price || 0
                ),
                (balance, laptopPrice) => balance >= laptopPrice
            );

            orderStats$ = saga.computed(
                orderCount$,
                saga.selectProperty('analytics').select(a => a.totalRevenue),
                (count, revenue) => ({
                    totalOrders: count,
                    totalRevenue: revenue,
                    averageOrderValue: count > 0 ? revenue / count : 0
                })
            );

            // Subscribe to reactive changes
            userBalance$.subscribe((newBalance, oldBalance) => {
                document.getElementById('balance-display').textContent = `$${newBalance}`;
                logReactive(`üí∞ Balance: $${oldBalance} ‚Üí $${newBalance}`);
            });

            orderCount$.subscribe((newCount, oldCount) => {
                document.getElementById('order-count').textContent = newCount;
                logReactive(`üì¶ Orders: ${oldCount} ‚Üí ${newCount}`);
            });

            canAffordLaptop$.subscribe((canAfford) => {
                document.getElementById('can-afford').textContent = canAfford ? 'Yes' : 'No';
                document.getElementById('can-afford').style.color = canAfford ? '#059669' : '#dc2626';
                logReactive(`üíª Can afford laptop: ${canAfford}`);
            });

            orderStats$.subscribe((stats) => {
                logReactive(`üìä Order stats: ${JSON.stringify(stats)}`);
            });
        }

        function setupEventListeners() {
            // Listen to saga events
            saga.onEvent('transaction:start', (event) => {
                log(`üöÄ Transaction started: ${event.transactionName}`);
            });

            saga.onEvent('transaction:success', (event) => {
                log(`‚úÖ Transaction completed: ${event.transactionName}`);
            });

            saga.onEvent('transaction:fail', (event) => {
                log(`‚ùå Transaction failed: ${event.transactionName} - ${event.error?.message}`);
            });

            saga.onEvent('step:start', (event) => {
                log(`üîß Step started: ${event.stepName}`);
            });

            saga.onEvent('step:success', (event) => {
                log(`‚úì Step completed: ${event.stepName}`);
            });
        }

        // State Management Functions
        function updateUser() {
            const name = document.getElementById('user-name').value;
            const balance = parseInt(document.getElementById('user-balance').value) || 0;

            saga.stateManager.setState({
                ...saga.getState(),
                user: {
                    ...saga.getState().user,
                    name,
                    balance
                }
            });

            log(`üë§ User updated: ${name}, Balance: $${balance}`);
        }

        function undo() {
            saga.stateManager.undo();
            log('‚Ü∂ Undo performed');
        }

        function redo() {
            saga.stateManager.redo();
            log('‚Ü∑ Redo performed');
        }

        function createSnapshot() {
            saga.stateManager.createSnapshot();
            log('üì∏ Snapshot created');
        }

        // Reactive Selector Functions
        function addRandomOrder() {
            const products = saga.getState().products;
            const randomProduct = products[Math.floor(Math.random() * products.length)];
            const quantity = Math.floor(Math.random() * 3) + 1;

            processOrderInternal(randomProduct.id, quantity);
        }

        function removeLastOrder() {
            const state = saga.getState();
            if (state.orders.length > 0) {
                const newState = {
                    ...state,
                    orders: state.orders.slice(0, -1)
                };
                saga.stateManager.setState(newState);
            }
        }

        // Transaction Functions
        function processOrder() {
            const productId = document.getElementById('product-select').value;
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            processOrderInternal(productId, quantity);
        }

        function processOrderWithFallback() {
            const productId = document.getElementById('product-select').value;
            const quantity = parseInt(document.getElementById('quantity').value) || 1;

            // Create transaction with fallback
            const fallbackTransaction = saga
                .createTransaction('order-fallback')
                .addStep('add-notification', (state) => {
                    state.notifications.push({
                        id: `notif_${Date.now()}`,
                        type: 'warning',
                        message: 'Order failed - insufficient funds',
                        timestamp: Date.now()
                    });
                });

            processOrderWithFallbackInternal(productId, quantity, fallbackTransaction);
        }

        function processFailingOrder() {
            // Try to order something expensive with insufficient funds
            processOrderInternal('laptop', 10); // This should fail
        }

        async function processOrderInternal(productId, quantity) {
            try {
                const orderTransaction = saga
                    .createTransaction('process-order')
                    .addStep('validate-product', (state, payload) => {
                        const product = state.products.find(p => p.id === payload.productId);
                        if (!product) {
                            throw new Error(`Product ${payload.productId} not found`);
                        }
                        if (product.stock < payload.quantity) {
                            throw new Error(`Insufficient stock for ${product.name}`);
                        }
                    })
                    .addStep('validate-balance', (state, payload) => {
                        const product = state.products.find(p => p.id === payload.productId);
                        const totalCost = product.price * payload.quantity;
                        if (state.user.balance < totalCost) {
                            throw new Error(`Insufficient funds. Need $${totalCost}, have $${state.user.balance}`);
                        }
                    })
                    .addStep('reserve-stock', (state, payload) => {
                        state.products = state.products.map(p =>
                            p.id === payload.productId
                                ? { ...p, stock: p.stock - payload.quantity }
                                : p
                        );
                    }, (state, payload) => {
                        // Compensation: restore stock
                        state.products = state.products.map(p =>
                            p.id === payload.productId
                                ? { ...p, stock: p.stock + payload.quantity }
                                : p
                        );
                    })
                    .addStep('charge-user', (state, payload) => {
                        const product = state.products.find(p => p.id === payload.productId);
                        const totalCost = product.price * payload.quantity;

                        // Update user balance immutably so reactive selectors fire
                        state.user = { ...state.user, balance: state.user.balance - totalCost };

                        // Update analytics immutably
                        const newTotalRevenue = state.analytics.totalRevenue + totalCost;
                        const newTotalOrders = state.analytics.totalOrders + 1;
                        state.analytics = {
                            ...state.analytics,
                            totalRevenue: newTotalRevenue,
                            totalOrders: newTotalOrders,
                            averageOrderValue: newTotalRevenue / newTotalOrders
                        };
                    })
                    .addStep('create-order', (state, payload) => {
                        const product = state.products.find(p => p.id === payload.productId);
                        const order = {
                            id: `order_${Date.now()}`,
                            userId: state.user.id,
                            productId: payload.productId,
                            productName: product.name,
                            quantity: payload.quantity,
                            amount: product.price * payload.quantity,
                            status: 'completed',
                            timestamp: Date.now()
                        };
                        state.orders = [...state.orders, order];

                        // Add success notification
                        state.notifications = [
                            ...state.notifications,
                            {
                                id: `notif_${Date.now()}`,
                                type: 'success',
                                message: `Order completed: ${payload.quantity}x ${product.name}`,
                                timestamp: Date.now()
                            }
                        ];
                    });

                await orderTransaction.run({ productId, quantity });

            } catch (error) {
                logTransaction(`‚ùå Order failed: ${error.message}`);
            }
        }

        async function processOrderWithFallbackInternal(productId, quantity, fallbackTransaction) {
            try {
                await processOrderInternal(productId, quantity);
            } catch (error) {
                // Execute fallback
                await fallbackTransaction.run({ productId, quantity });
                logTransaction(`üîÑ Fallback executed due to: ${error.message}`);
            }
        }

        // Event Replay Functions
        function startRecording() {
            try {
                const sessionId = saga.startRecording({
                    description: 'HTML Demo Recording',
                    testCase: 'user-interaction-flow'
                });

                isRecording = true;
                recordedEvents = []; // Reset events array
                document.getElementById('record-btn').disabled = true;
                document.getElementById('stop-btn').disabled = false;
                document.getElementById('replay-btn').disabled = true;
                document.getElementById('recording-status').innerHTML =
                    '<div class="recording" style="color: #ef4444; font-weight: bold;">üî¥ Recording...</div>';

                logReplay(`üî¥ Recording started: ${sessionId}`);
                logReplay(`üì° Ready to capture events...`);

                // Test if recording is working
                setTimeout(() => {
                    const currentEvents = saga.getRecordedEvents();
                    logReplay(`üìä Current events in buffer: ${currentEvents.length}`);
                }, 1000);

            } catch (error) {
                logReplay(`‚ùå Failed to start recording: ${error.message}`);
                console.error('Recording error:', error);
            }
        }

        function stopRecording() {
            try {
                const session = saga.stopRecording();
                recordedEvents = saga.getRecordedEvents();

                isRecording = false;
                document.getElementById('record-btn').disabled = false;
                document.getElementById('stop-btn').disabled = true;

                if (recordedEvents && recordedEvents.length > 0) {
                    document.getElementById('replay-btn').disabled = false;
                    document.getElementById('recording-status').innerHTML =
                        `<div style="color: #059669; font-weight: bold;">‚èπÔ∏è Recording stopped (${recordedEvents.length} events)</div>`;
                    logReplay(`‚èπÔ∏è Recording stopped. ${recordedEvents.length} events captured`);

                    // Show some event details
                    logReplay(`üìã Event types recorded: ${[...new Set(recordedEvents.map(e => e.type))].join(', ')}`);
                } else {
                    document.getElementById('recording-status').innerHTML =
                        `<div style="color: #f59e0b; font-weight: bold;">‚ö†Ô∏è Recording stopped (no events captured)</div>`;
                    logReplay(`‚ö†Ô∏è Recording stopped but no events were captured`);
                    logReplay(`üí° Try performing some actions (update user, process orders) while recording`);
                }

            } catch (error) {
                logReplay(`‚ùå Failed to stop recording: ${error.message}`);
                console.error('Stop recording error:', error);
                isRecording = false;
                document.getElementById('record-btn').disabled = false;
                document.getElementById('stop-btn').disabled = true;
            }
        }

        async function replayEvents() {
            if (recordedEvents.length === 0) {
                logReplay('‚ùå No events to replay');
                return;
            }

            logReplay('‚ñ∂Ô∏è Starting replay...');
            logReplay(`üìä Replaying ${recordedEvents.length} events`);

            try {
                // Export current recording and import it for replay
                const exportData = saga.exportRecording();
                if (!exportData || exportData === '{"events":[]}') {
                    logReplay('‚ùå No events found in recording');
                    return;
                }

                // Import the recording for replay
                saga.importRecording(exportData);

                const replayManager = saga.getReplayManager();
                const replayer = replayManager.getReplayer();

                // Set up replay monitoring
                replayer.onStateChange((state) => {
                    logReplay(`üé¨ Replay progress: ${state.currentEvent}/${state.totalEvents}`);
                });

                // Start the replay
                await saga.startReplay({
                    realTimeMode: false, // Fast replay
                    pauseOnErrors: false
                });

                logReplay('‚úÖ Replay completed successfully');
            } catch (error) {
                logReplay(`‚ùå Replay failed: ${error.message}`);
                console.error('Replay error details:', error);
            }
        }

        function clearEvents() {
            recordedEvents = [];
            document.getElementById('replay-btn').disabled = true;
            document.getElementById('recording-status').innerHTML = '';
            document.getElementById('replay-output').innerHTML = '';
            logReplay('üóëÔ∏è Events cleared');
        }

        function testEventGeneration() {
            if (!isRecording) {
                logReplay('‚ö†Ô∏è Start recording first, then click this button to generate test events');
                return;
            }

            logReplay('üß™ Generating test events...');

            // Generate a sequence of events to test recording
            setTimeout(() => {
                // Update user balance
                saga.stateManager.setState({
                    ...saga.getState(),
                    user: {
                        ...saga.getState().user,
                        balance: saga.getState().user.balance + 100
                    }
                });
                logReplay('‚úì Generated balance update event');
            }, 100);

            setTimeout(() => {
                // Add a notification
                saga.stateManager.setState({
                    ...saga.getState(),
                    notifications: [
                        ...saga.getState().notifications,
                        {
                            id: `test_${Date.now()}`,
                            type: 'info',
                            message: 'Test event generated',
                            timestamp: Date.now()
                        }
                    ]
                });
                logReplay('‚úì Generated notification event');
            }, 200);

            setTimeout(() => {
                const currentEvents = saga.getRecordedEvents();
                logReplay(`üìä Events after test: ${currentEvents.length}`);
            }, 300);
        }

        // Rendering Functions
        function setupRendering() {
            // Subscribe to entire state and render whenever it changes
            state$ = saga.select(state => state);
            state$.subscribe(render);
            render(saga.getState());
        }

        function render(state) {
            // Update form fields
            document.getElementById('user-name').value = state.user.name;
            document.getElementById('user-balance').value = state.user.balance;

            // Update full state display
            document.getElementById('full-state').textContent = JSON.stringify(state, null, 2);

            // Update metrics
            const metrics = saga.getPerformanceMetrics();
            document.getElementById('metrics-display').innerHTML = `
                <div class="metric">
                    <div class="metric-value">${metrics.totalChanges}</div>
                    <div class="metric-label">State Changes</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${metrics.undoOperations}</div>
                    <div class="metric-label">Undo Ops</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${metrics.redoOperations}</div>
                    <div class="metric-label">Redo Ops</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${state.orders.length}</div>
                    <div class="metric-label">Total Orders</div>
                </div>
                <div class="metric">
                    <div class="metric-value">$${state.analytics.totalRevenue}</div>
                    <div class="metric-label">Revenue</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${state.notifications.length}</div>
                    <div class="metric-label">Notifications</div>
                </div>
            `;
        }

        // Logging Functions
        function log(message) {
            const output = document.getElementById('state-output');
            const div = document.createElement('div');
            div.className = 'event-item';
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }

        function logReactive(message) {
            const output = document.getElementById('reactive-output');
            const div = document.createElement('div');
            div.className = 'event-item success';
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }

        function logTransaction(message) {
            const output = document.getElementById('transaction-output');
            const div = document.createElement('div');
            div.className = message.includes('‚ùå') ? 'event-item error' : 'event-item success';
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }

        function logReplay(message) {
            const output = document.getElementById('replay-output');
            const div = document.createElement('div');
            div.className = 'event-item';
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>

</html>